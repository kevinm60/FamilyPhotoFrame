@startuml

hide footbox
title high level sequence
skinparam monochrome true

participant MainActivity
participant PhotoFrameActivity
participant PhotoCollection
participant PhotoCollection
participant FlickrClient
participant ShowPlanner
participant Display

MainActivity -> FlickrClient : run login flow
  activate FlickrClient
  deactivate FlickrClient

MainActivity -\ PhotoFrameActivity : start
  activate PhotoFrameActivity
  destroy MainActivity

alt after n hours
  PhotoFrameActivity -> PhotoCollection : startDiscovery()
  activate PhotoCollection
    PhotoCollection -> FlickrClient : get profile
      activate FlickrClient
      deactivate FlickrClient
    PhotoCollection -> FlickrClient : get contacts
      activate FlickrClient
      deactivate FlickrClient
    PhotoCollection -> FlickrClient : get photos for each contact
      activate FlickrClient
      deactivate FlickrClient
    PhotoCollection -> FlickrClient : get date for each photo,\nunless the photo is cached
      activate FlickrClient
      deactivate FlickrClient
  deactivate PhotoCollection
end

PhotoFrameActivity -> Display : run
  activate Display
    loop
      alt if there are fewer than MIN_INDEX_SIZE items in the queue
        Display -> ShowPlanner : choose photos to show for the next hour\norder them\nadd to queue
          activate ShowPlanner
          ShowPlanner -> PhotoCollection : get / choose
            activate PhotoCollection
            deactivate PhotoCollection
          deactivate ShowPlanner
      end

      Display -> Display : pop photo at head queue\nshow it\nfetch new photo at head of queue
        activate Display
        deactivate Display

      Display -> Display : schedule run to be called after FRAME_DURATION
        activate Display
        deactivate Display
    end
  deactivate Display

@enduml
